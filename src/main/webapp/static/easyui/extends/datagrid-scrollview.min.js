function calculateDataGridTrStyleHeight(a){var b,c;return"string"==typeof a?b=a:a&&(classValue=a["class"]||"",b=a["style"]||""),b&&b.indexOf("height")>-1?(c=b.indexOf("height")+7,b=b.substr(c),b.substring(0,b.indexOf(";")).replace("px","")):25}var scrollview=$.extend({},$.fn.datagrid.defaults.view,{render:function(a,b,c){var g,h,i,j,k,l,m,n,o,p,d=$.data(a,"datagrid"),e=d.options,f=this.rows||[];if(f.length&&(g=$(a).datagrid("getColumnFields",c),!c||e.rownumbers||e.frozenColumns&&e.frozenColumns.length)){for(h=this.index,i="",j="",k="",l=['<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'],m=0;m<f.length;m++)n=e.rowStyler?e.rowStyler.call(a,h,f[m]):"","string"==typeof n?j=n:n&&(i=n["class"]||"",j=n["style"]||""),o='class="datagrid-row '+(h%2&&e.striped?"datagrid-row-alt ":" ")+i+'"',k=c?'style="height:'+e.rowHeight+'px;"':j?'style="'+j+'"':'style="height:25px;"',p=d.rowIdPrefix+"-"+(c?1:2)+"-"+h,l.push('<tr id="'+p+'" datagrid-row-index="'+h+'" '+o+" "+k+">"),l.push(this.renderRow.call(this,a,g,c,h,f[m])),l.push("</tr>"),e.detailFormatter&&(l.push('<tr style="display:none;">'),c?l.push("<td colspan="+(g.length+2)+' style="border-right:0">'):l.push("<td colspan="+g.length+">"),l.push('<div class="datagrid-row-detail">'),c?l.push("&nbsp;"):l.push(e.detailFormatter.call(a,m,f[m])),l.push("</div>"),l.push("</td>"),l.push("</tr>")),h++;l.push("</tbody></table>"),$(b).html(l.join(""))}},renderRow:function(a,b,c,d,e){var h,i,j,k,l,m,n,o,p,q,f=$.data(a,"datagrid").options,g=[];for(c&&f.rownumbers&&(h=d+1,f.pagination&&(h+=(f.pageNumber-1)*f.pageSize),g.push('<td class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber" style="text-align:center">'+h+"</div></td>")),i=0;i<b.length;i++)j=b[i],k=$(a).datagrid("getColumnOption",j),k&&(l=e[j],m=k.styler?k.styler(l,e,d)||"":"",n="",o="","string"==typeof m?o=m:g&&(n=m["class"]||"",o=m["style"]||""),p=n?'class="'+n+'"':"",q=k.hidden?'style="display:none;'+o+'"':o?'style="'+o+'"':"",g.push('<td field="'+j+'" '+p+" "+q+">"),k.checkbox?q="height:15;":k.expander?q="text-align:center;height:15;":(q=o,k.align&&(q+=";text-align:"+k.align+";"),f.nowrap?f.autoRowHeight&&(q+=";height:auto;"):q+=";white-space:normal;height:auto;"),g.push('<div style="'+q+'" '),k.checkbox?g.push('class="datagrid-cell-check'):g.push('class="datagrid-cell '+k.cellClass),g.push('">'),k.checkbox?g.push('<input type="checkbox" name="'+j+'" value="'+(void 0!=l?l:"")+'">'):k.expander?g.push('<span class="datagrid-row-expander datagrid-row-expand" style="display:inline-block;width:25px;height:auto;cursor:pointer;" />'):k.formatter?g.push(k.formatter(l,e,d)):g.push(l),g.push("</div>"),g.push("</td>"));return g.join("")},bindEvents:function(a){var e,f,b=$.data(a,"datagrid"),c=b.dc;b.options,e=c.body1.add(c.body2),f=($.data(e[0],"events")||$._data(e[0],"events")).click[0].handler,e.unbind("click").bind("click",function(b){var e,c=$(b.target),d=c.closest("tr.datagrid-row");d.length&&(c.hasClass("datagrid-row-expander")?(e=parseInt(d.attr("datagrid-row-index")),c.hasClass("datagrid-row-expand")?$(a).datagrid("expandRow",e):$(a).datagrid("collapseRow",e),$(a).datagrid("fixRowHeight")):f(b),b.stopPropagation())})},onBeforeRender:function(a){function f(){b.onLoadSuccess=c.onLoadSuccess,c.onLoadSuccess=function(){},setTimeout(function(){d.body2.unbind(".datagrid").bind("scroll.datagrid",function(){b.onLoadSuccess&&(c.onLoadSuccess=b.onLoadSuccess,b.onLoadSuccess=void 0),e.scrollTimer&&clearTimeout(e.scrollTimer),e.scrollTimer=setTimeout(function(){g.call(e)},50)}),d.body2.triggerHandler("scroll.datagrid")},0)}function g(){function j(){var b=$(d.body2).scrollTop(),e=Math.floor(b/c.rowHeight),f=Math.floor(e/c.viewPageSize)+1;this.getRows.call(this,a,f,function(b){this.index=(f-1)*c.viewPageSize,this.rows=b,this.r1=b,this.r2=[],this.populate.call(this,a),d.body2.triggerHandler("scroll.datagrid")})}var b,e,f,g,h,i;d.body2.is(":empty")?j.call(this):(b=c.finder.getTr(a,this.index,"body",2),e=c.finder.getTr(a,0,"last",2),f=d.view2.children("div.datagrid-header").outerHeight(),g=b.position().top-f,h=e.position().top+e.outerHeight()-f,g>d.body2.height()||0>h?j.call(this):g>0?(i=Math.floor(this.index/c.viewPageSize),this.getRows.call(this,a,i,function(b){this.r2=this.r1,this.r1=b,this.index=(i-1)*c.viewPageSize,this.rows=this.r1.concat(this.r2),this.populate.call(this,a)})):h<d.body2.height()&&(i=Math.floor(this.index/c.viewPageSize)+2,this.r2.length&&i++,this.getRows.call(this,a,i,function(b){this.r2.length?(this.r1=this.r2,this.r2=b,this.index+=c.viewPageSize):this.r2=b,this.rows=this.r1.concat(this.r2),this.populate.call(this,a)})))}function h(){var b,f,g,h,i,j;if(c.detailFormatter){for(b=$(a),f=!1,g=b.datagrid("getColumnFields",!0).concat(b.datagrid("getColumnFields")),h=0;h<g.length;h++)if(i=b.datagrid("getColumnOption",g[h]),i.expander){f=!0;break}f||(c.frozenColumns&&c.frozenColumns.length?c.frozenColumns[0].splice(0,0,{field:"_expander",expander:!0,width:24,resizable:!1,fixed:!0}):c.frozenColumns=[[{field:"_expander",expander:!0,width:24,resizable:!1,fixed:!0}]],b=d.view1.children("div.datagrid-header").find("table"),j=$('<td rowspan="'+c.frozenColumns.length+'"><div class="datagrid-header-expander" style="width:24px;"></div></td>'),0==$("tr",b).length?j.wrap("<tr></tr>").parent().appendTo($("tbody",b)):c.rownumbers?j.insertAfter(b.find("td:has(div.datagrid-header-rownumber)")):j.prependTo(b.find("tr:first"))),setTimeout(function(){e.bindEvents(a)},0)}}var b=$.data(a,"datagrid"),c=b.options,d=b.dc,e=this;c.rowHeight=calculateDataGridTrStyleHeight(c.rowStyler?c.rowStyler.call(null,null,null):""),c.viewPageSize=Math.floor(d.body2.height()/c.rowHeight)+10,b.data.cacheRows=b.data.rows,c.finder.getRow=function(a,b){var e,c="object"==typeof b?b.attr("datagrid-row-index"):b,d=$.data(a,"datagrid").data.rows[c];return d||(e=$(a).datagrid("options").view,d=e.rows[c-e.index]),d},d.body1.add(d.body2).empty(),this.rows=void 0,this.r1=this.r2=[],f(),h()},onAfterRender:function(a){var b,c;$.fn.datagrid.defaults.view.onAfterRender.call(this,a),b=$.data(a,"datagrid").dc,c=b.footer1.add(b.footer2),c.find("span.datagrid-row-expander").css("visibility","hidden")},getRows:function(a,b,c){var d=$.data(a,"datagrid"),e=d.options,f=(b-1)*e.viewPageSize,g=d.data.cacheRows.slice(f,f+e.viewPageSize);g.length&&c.call(this,g)},populate:function(a){var f,g,b=$.data(a,"datagrid"),c=b.options,d=b.dc,e=c.rowHeight;if(this.rows.length&&(c.view.render.call(c.view,a,d.body2,!1),c.view.render.call(c.view,a,d.body1,!0),d.body1.add(d.body2).children("table.datagrid-btable").css({marginTop:this.index*e,marginBottom:b.data.cacheRows.length*e-this.rows.length*e-this.index*e})),this.rows.length){for(f=[],g=0;g<this.index;g++)f.push({});b.data.rows=f.concat(this.rows),c.onLoadSuccess.call(a,{total:this.rows.length,rows:this.rows})}}});$.extend($.fn.datagrid.methods,{fixDetailRowHeight:function(a,b){return a.each(function(){var f,a=$.data(this,"datagrid").options,c=$.data(this,"datagrid").dc,d=a.finder.getTr(this,b,"body",1).next(),e=a.finder.getTr(this,b,"body",2).next();e.is(":visible")&&(d.css("height",""),e.css("height",""),f=Math.max(d.height(),e.height()),d.css("height",f),e.css("height",f)),c.body2.triggerHandler("scroll")})},getExpander:function(a,b){var c=$.data(a[0],"datagrid").options;return c.finder.getTr(a[0],b).find("span.datagrid-row-expander")},getRowDetail:function(a,b){var c=$.data(a[0],"datagrid").options,d=c.finder.getTr(a[0],b,"body",2);return d.next().find("div.datagrid-row-detail")},expandRow:function(a,b){return a.each(function(){var d,e,f,g,a=$(this).datagrid("options");$.data(this,"datagrid").dc,d=$(this).datagrid("getExpander",b),d.hasClass("datagrid-row-expand")&&(d.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse"),e=a.finder.getTr(this,b,"body",1).next(),f=a.finder.getTr(this,b,"body",2).next(),e.show(),f.show(),$(this).datagrid("fixDetailRowHeight",b),a.onExpandRow&&(g=$(this).datagrid("getRows")[b],a.onExpandRow.call(this,b,g)))})},collapseRow:function(a,b){return a.each(function(){var e,f,g,a=$(this).datagrid("options"),c=$.data(this,"datagrid").dc,d=$(this).datagrid("getExpander",b);d.hasClass("datagrid-row-collapse")&&(d.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand"),e=a.finder.getTr(this,b,"body",1).next(),f=a.finder.getTr(this,b,"body",2).next(),e.hide(),f.hide(),c.body2.triggerHandler("scroll"),a.onCollapseRow&&(g=$(this).datagrid("getRows")[b],a.onCollapseRow.call(this,b,g)))})}});