!function(a){function b(b){var e,f,g,h,i;for(a(b).addClass("portal"),e=a('<table border="0" cellspacing="0" cellpadding="0"><tr></tr></table>').appendTo(b),f=e.find("tr"),g=[],h=0,a(b).find(">div").each(function(){var e,c=a(this);h+=c.outerWidth(),g.push(c.outerWidth()),e=a('<td class="portal-column-td"></td>').appendTo(f),c.addClass("portal-column").appendTo(e),c.find(">div").each(function(){var c=a(this).addClass("portal-p").panel({doSize:!1,cls:"portal-panel"});d(b,c)})}),i=0;i<g.length;i++)g[i]/=h;return a(b).bind("_resize",function(){var d=a.data(b,"portal").options;return 1==d.fit&&c(b),!1}),g}function c(b){var e,f,g,h,i,j,k,c=a(b),d=a.data(b,"portal").options;for(d.fit&&(e=c.parent(),d.width=e.width(),d.height=e.height()),isNaN(d.width)?c.width("auto"):1==a.boxModel?c.width(d.width-(c.outerWidth()-c.width())):c.width(d.width),isNaN(d.height)?c.height("auto"):1==a.boxModel?c.height(d.height-(c.outerHeight()-c.height())):c.height(d.height),f=c.find(">table").outerHeight()>c.height(),g=c.width(),h=a.data(b,"portal").columnWidths,i=0,j=0;j<h.length;j++)e=c.find("div.portal-column:eq("+j+")"),k=Math.floor(g*h[j]),j==h.length-1&&(k=g-i-(1==f?28:10)),1==a.boxModel?e.width(k-(e.outerWidth()-e.width())):e.width(k),i+=e.outerWidth(),e.find("div.portal-p").panel("resize",{width:e.width()})}function d(b,d){function f(c,d){var e=null;return a(b).find("div.portal-p").each(function(){var f,b=a(this).panel("panel");b[0]!=d&&(f=b.offset(),c.pageX>f.left&&c.pageX<f.left+b.outerWidth()&&c.pageY>f.top&&c.pageY<f.top+b.outerHeight()&&(e=c.pageY>f.top+b.outerHeight()/2?{target:b,pos:"down"}:{target:b,pos:"up"}))}),e}function g(c){var d=null;return a(b).find("div.portal-column").each(function(){var b=a(this),e=b.offset();c.pageX>e.left&&c.pageX<e.left+b.outerWidth()&&(d=b)}),d}function h(b,c){1==a.boxModel?(e.width(b-(e.outerWidth()-e.width())),c&&e.height(c-(e.outerHeight()-e.height()))):(e.width(b),c&&e.height(c))}var e;d.panel("panel").draggable({handle:">div.panel-header>div.panel-title",proxy:function(b){var c=a('<div class="portal-proxy">proxy</div>').insertAfter(b);return c.width(a(b).width()),c.height(a(b).height()),c.html(a(b).html()),c.find("div.portal-p").removeClass("portal-p"),c},onStartDrag:function(){a(this).hide(),e=a('<div class="portal-spacer"></div>').insertAfter(this),h(a(this).outerWidth(),a(this).outerHeight())},onDrag:function(d){var j,i=f(d,this);i?("up"==i.pos?e.insertBefore(i.target):e.insertAfter(i.target),h(a(i.target).outerWidth())):(j=g(d),j&&0==j.find("div.portal-spacer").length&&(e.appendTo(j),c(b),h(j.width())))},onStopDrag:function(){a(this).css("position","static"),a(this).show(),e.hide(),a(this).insertAfter(e),e.remove(),c(b);var f=a.data(b,"portal").options;f.onStopDrag.call()}})}function e(a){var d,b=[],c=function(a){return"object"==typeof a&&null!=a?e(a):/^(string|number)$/.test(typeof a)?"'"+a+"'":a};for(d in a)b.push("'"+d+"':"+c(a[d]));return"{"+b.join(",")+"}"}a.fn.portal=function(d,e){return"string"==typeof d?a.fn.portal.methods[d](this,e):(d=d||{},this.each(function(){var e=a.data(this,"portal");e?a.extend(e.options,d):e=a.data(this,"portal",{options:a.extend({},a.fn.portal.defaults,a.fn.portal.parseOptions(this),d),columnWidths:b(this)}),e.options.border?a(this).removeClass("portal-noborder"):a(this).addClass("portal-noborder"),c(this)}))},a.fn.portal.methods={options:function(b){return a.data(b[0],"portal").options},resize:function(b,d){return b.each(function(){if(d){var b=a.data(this,"portal").options;d.width&&(b.width=d.width),d.height&&(b.height=d.height)}c(this)})},getPanels:function(b,c){var e,d=b;return c&&(d=b.find("div.portal-column:eq("+c+")")),e=[],d.find("div.portal-p").each(function(){e.push(a(this))}),e},add:function(b,c){return b.each(function(){var b=a(this).find("div.portal-column:eq("+c.columnIndex+")"),e=c.panel.addClass("portal-p");e.panel("open"),e.panel("panel").addClass("portal-panel").appendTo(b),d(this,e),e.panel("resize",{width:b.width()})})},remove:function(b,c){return b.each(function(){var d,e,b=a(this).portal("getPanels");for(d=0;d<b.length;d++)e=b[d],e[0]==a(c)[0]&&e.panel("destroy")})},getLayout:function(b){var h,i,j,k,c=a(b).portal("getPanels"),d=a(b).find(".portal-column-td"),f="{",g=0;for(h=0;h<d.length;h++){for(i='"'+h+'":[',j=a(d[h]).find(".portal-panel").length,k=0;j>k;k++)i+=e(c[g].panel("options"))+",",g++;i=i.substring(0,i.length-1)+"]",f+=i+","}return""==f.substring(0,f.length-1)?f+="}":f=f.substring(0,f.length-1)+"}",f},getPanelForTitle:function(b,c){var e,d=a(b).portal("getPanels");return a.each(d,function(a,b){return b.panel("options").title==c?(e=b,void 0):void 0}),e}},a.fn.portal.parseOptions=function(b){var c=a(b);return{width:parseInt(b.style.width)||void 0,height:parseInt(b.style.height)||void 0,border:c.attr("border")?"true"==c.attr("border"):void 0,fit:c.attr("fit")?"true"==c.attr("fit"):void 0}},a.fn.portal.defaults={width:"auto",height:"auto",border:!0,fit:!1,onStopDrag:function(){}}}(jQuery);